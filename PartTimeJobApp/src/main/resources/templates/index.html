<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Trang chủ</title>
    <th:context th:replace="base :: boostrap"></th:context>
    <th:context th:replace="base :: resources"></th:context>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #statsChart {
            max-width: 100%;
            max-height: 500px;
        }
    </style>
</head>
<body>
    <div th:replace="base :: header"></div>
    <div th:replace="base :: menu"></div>

    <main class="container">
        <h1 class="text-info text-center mt-2">THỐNG KÊ</h1>
        <div class="row">
            <div class="col-12">
                <canvas id="statsChart" height="120"></canvas>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-md-4">
                <h5>Việc làm theo tháng</h5>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Tháng</th>
                            <th>Số việc làm</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="stat : ${jobsStats}">
                            <td th:text="${stat[0]}"></td>
                            <td th:text="${stat[1]}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-4">
                <h5>Ứng viên theo tháng</h5>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Tháng</th>
                            <th>Số ứng viên</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="stat : ${candidatesStats}">
                            <td th:text="${stat[0]}"></td>
                            <td th:text="${stat[1]}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-4">
                <h5>Nhà tuyển dụng theo tháng</h5>
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Tháng</th>
                            <th>Số nhà tuyển dụng</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="stat : ${employersStats}">
                            <td th:text="${stat[0]}"></td>
                            <td th:text="${stat[1]}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div th:replace="base :: footer"></div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        // Lấy dữ liệu từ model
        let jobsStats = /*[[${jobsStats}]]*/ [];
        let candidatesStats = /*[[${candidatesStats}]]*/ [];
        let employersStats = /*[[${employersStats}]]*/ [];

        function fillData(stats) {
            let arr = Array(12).fill(0);
            stats.forEach(function (s) {
                arr[s[0] - 1] = s[1];
            });
            return arr;
        }

        let jobsData = fillData(jobsStats);
        let candidatesData = fillData(candidatesStats);
        let employersData = fillData(employersStats);

        let months = ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'];

        const ctx = document.getElementById('statsChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Việc làm',
                        data: jobsData,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.5)'
                    },
                    {
                        label: 'Ứng viên',
                        data: candidatesData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.5)'
                    },
                    {
                        label: 'Nhà tuyển dụng',
                        data: employersData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.5)'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'top' },
                    title: { display: true, text: 'Biểu đồ thống kê theo tháng' }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: { display: true },
                        // Giúp mốc nằm giữa cột
                        offset: true
                    },
                    y: {
                        beginAtZero: true,
                        precision: 0,
                        grid: { display: true }
                    }
                }
            }
        });
        /*]]>*/
    </script>
</body>
</html>